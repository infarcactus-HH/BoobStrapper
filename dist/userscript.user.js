// ==UserScript==
// @name         BoobStraper
// @namespace    http://tampermonkey.net/
// @version      1.1.0
// @description  
// @author       infarcactus
// @license      ISC
// @match        https://nutaku.haremheroes.com/*
// @match        https://*.hentaiheroes.com/*
// @match        https://*.gayharem.com/*
// @match        https://*.comixharem.com/*
// @match        https://*.hornyheroes.com/*
// @match        https://*.pornstarharem.com/*
// @match        https://*.transpornstarharem.com/*
// @match        https://*.gaypornstarharem.com/*
// @match        https://*.mangarpg.com/*
// @updateURL    https://github.com/infarcactus-HH/BoobStrapper/raw/refs/heads/main/dist/userscript.user.js
// @downloadURL  https://github.com/infarcactus-HH/BoobStrapper/raw/refs/heads/main/dist/userscript.user.js
// @grant        unsafeWindow
// @grant        GM_getValue
// @grant        GM_setValue
// @grant        GM_deleteValue
// @grant        GM_addStyle
// @run-at       document-body
// ==/UserScript==

"use strict";(()=>{var e=class{static getConfigValue(e,t){return GM_getValue(e,t)}static setConfigValue(e,t){GM_setValue(e,t)}static getConfigModuleKey(e,t){return`Config_${e}_${t}`}static getConfigSubSettingKey(e,t,o){return`Config_${e}_${t}_SubSetting_${o}`}},t=class{static doWhenSelectorAvailable(e,t){let o=$(e);if(o.length)t(o);else{let o=new MutationObserver(()=>{let s=$(e);s.length&&(o.disconnect(),t(s))});o.observe(document.documentElement,{childList:!0,subtree:!0})}}},o=class{static run(){t.doWhenSelectorAvailable("header > .hh_logo > img",e=>{let t=e.attr("src");GM_addStyle(`:root {--config-button-icon: url(${t});}`)}),GM_addStyle(`:root {--cross-icon : url(${IMAGES_URL}/clubs/ic_xCross.png)}`)}},s=class{constructor(){this.groups=[],this.modules=[],this.config={},this.$settingsButton=null,this.$configPannel=null,unsafeWindow.BoobStrapperConfig={registerGroup:this.registerGroup.bind(this),registerModule:this.registerModule.bind(this),runModules:this.runModules.bind(this)},unsafeWindow.BoobStrapper={Helpers:{doWhenSelectorAvailable:t.doWhenSelectorAvailable}},"/home.html"===location.pathname&&this.addConfigToggles()}registerGroup(e){if(!(t=e).key||!t.name)throw new Error("Invalid group");var t;this.groups.find(t=>t.key===e.key)?console.warn(`Group with key ${e.key} is already registered.`):this.groups.push(e)}registerModule(t){if(!((o=t).group&&o.configSchema&&o.configSchema.baseKey&&o.configSchema.label&&void 0!==o.configSchema.default&&void 0!==o.run))throw new Error("Invalid module");var o;if(!this.groups.find(e=>e.key===t.group))throw new Error(`Group with key ${t.configSchema.baseKey} is not registered.`);this.modules.push(t);let s=e.getConfigModuleKey(t.group,t.configSchema.baseKey);if(this.config[s]=e.getConfigValue(s,t.configSchema.default),t.configSchema.subSettings){let o=t.configSchema.baseKey;for(let s of t.configSchema.subSettings){let n=e.getConfigSubSettingKey(t.group,o,s.key);this.config[n]=e.getConfigValue(n,s.default)}}}runModules(){for(let t of this.modules){let o=e.getConfigModuleKey(t.group,t.configSchema.baseKey);if(this.config[o]){let o=t.configSchema.subSettings?.reduce((o,s)=>{let n=e.getConfigSubSettingKey(t.group,t.configSchema.baseKey,s.key);return o[s.key]=this.config[n],o},{});try{t.run(o)}catch(e){console.error(`Error running module ${t.configSchema.baseKey}:`,e)}}}}addConfigToggles(){(async function(){o.run(),GM_addStyle('.hh-plus-plus-config-button.boob-strapped{position:absolute;right:200px;cursor:pointer;background-size:contain;background-image:var(--config-button-icon);z-index:5}@media(min-width:1026px){.hh-plus-plus-config-button.boob-strapped{height:35px;width:35px;top:56px}}@media(max-width:1025px){.hh-plus-plus-config-button.boob-strapped{height:64px;width:64px;top:85px;right:140px}}@media(min-width:1026px){.hh-plus-plus-config-button.boob-strapped:after{font-size:20px;height:20px;line-height:20px}}@media(max-width:1025px){.hh-plus-plus-config-button.boob-strapped:after{font-size:35px;height:40px;line-height:46px}}.hh-plus-plus-config-button.boob-strapped:after{content:"BS";position:absolute;width:auto;bottom:-3px;right:-5px;text-shadow:0 0 1px #000,0 0 1px #000,0 0 1px #000,0 0 1px #000,0 0 1px #000,0 0 1px #000,0 0 1px #000,0 0 1px #000,0 0 1px #000,0 0 1px #000,0 0 1px #000;-webkit-transform:rotate(-18.95deg);-moz-transform:rotate(-18.95deg);transform:rotate(-18.95deg)}')})(),this.$settingsButton=$('<div class="hh-plus-plus-config-button boob-strapped" hh_title="BoobStrapper" tooltip></div>').on("click",()=>{this.generateConfigPannel()}),t.doWhenSelectorAvailable("#contains_all",e=>{this.$settingsButton&&e.append(this.$settingsButton)})}generateConfigPannel(){if(this.$configPannel&&!this.$configPannel.hasClass("shown"))return void this.$configPannel.addClass("shown");if(!this.$settingsButton||this.$configPannel)return;(async function(){GM_addStyle(".hh-plus-plus-config-panel.boob-strapper{background:linear-gradient(to top,#572332 0 1%,#2c1e1c);border-image-slice:1;border-image-source:linear-gradient(180deg,#ffa23e,#c41b53);border-style:solid;border-width:4px;box-shadow:inset 0 0 40px 15px #662034;display:none;height:470px;position:absolute;right:63px;top:70px;width:900px;z-index:100}.hh-plus-plus-config-panel.boob-strapper.shown{display:block}.hh-plus-plus-config-panel.boob-strapper .close-config-panel{background-image:var(--cross-icon);background-size:cover;cursor:pointer;display:block;height:37px;position:absolute;right:6px;top:6px;width:41px}.hh-plus-plus-config-panel.boob-strapper .tabs{display:flex;height:2.5rem;max-width:53rem;white-space:nowrap}.hh-plus-plus-config-panel.boob-strapper .tabs h4{color:#d08467;cursor:pointer;display:block;float:left;font-size:18px;font-weight:400;height:26px;letter-spacing:.22px;line-height:30px;margin:0 15px;position:relative;text-align:center;text-shadow:1px 1px 0 #000,-1px 1px 0 #000,-1px -1px 0 #000,1px -1px 0 #000}.hh-plus-plus-config-panel.boob-strapper .tabs h4:first-child{margin-left:15px}.hh-plus-plus-config-panel.boob-strapper .tabs h4.selected{color:#ffb827;cursor:initial;font-size:20px;font-weight:400;height:30px;letter-spacing:.22px;padding-top:2px;text-shadow:-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000,-2px -2px 5px rgba(255,159,0,.4),2px -2px 5px rgba(255,159,0,.4),-2px 2px 5px rgba(255,159,0,.4),2px 2px 5px rgba(255,159,0,.4),0 0 10px rgba(255,159,0,.4)}.hh-plus-plus-config-panel.boob-strapper .group-panel{display:none;height:405px;position:absolute;top:54px;width:889px}.hh-plus-plus-config-panel.boob-strapper .group-panel.shown{display:block}.hh-plus-plus-config-panel.boob-strapper .group-panel .panel-contents{display:grid;gap:10px;grid-template-columns:repeat(5,1fr);height:100%;padding-left:10px;padding-right:10px;width:100%}.hh-plus-plus-config-panel.boob-strapper .config-setting{background:#200307e6;border:1px solid #aaa;border-radius:6px;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;font-size:14px;padding:7px}.hh-plus-plus-config-panel.boob-strapper .config-setting.enabled{border-color:#ffb827}.hh-plus-plus-config-panel.boob-strapper .config-setting.has-subsettings{grid-row-end:span 2}.hh-plus-plus-config-panel.boob-strapper .base-setting{display:flex}.hh-plus-plus-config-panel.boob-strapper .base-setting span{flex:1}.hh-plus-plus-config-panel.boob-strapper .sub-settings{font-size:12px;margin-top:8px}.hh-plus-plus-config-panel.boob-strapper .sub-settings label{align-items:center;display:flex;margin-bottom:6px}.hh-plus-plus-config-panel.boob-strapper .sub-settings label span{flex:1}.hh-plus-plus-config-panel.boob-strapper .sub-settings label input{margin-left:0}.hh-plus-plus-config-panel.boob-strapper .sub-settings label input[disabled]{background-color:initial;box-shadow:unset;-webkit-box-shadow:unset}")})(),this.$configPannel=$('<div class="hh-plus-plus-config-panel boob-strapper shown">'),this.$settingsButton.after(this.$configPannel);let t=$('<span class="close-config-panel"></span>').on("click",()=>{this.$configPannel?.removeClass("shown")});this.$configPannel.append(t);let o=$('<div class="tabs hh-scroll"></div>');this.$configPannel.append(o);for(let t of this.groups){let s=$(`<h4 class="${t.key}" rel="${t.key}">${t.name}</div>`).on("click",()=>{s.siblings().removeClass("selected"),s.addClass("selected"),this.$configPannel?.find(".group-panel").removeClass("shown").filter(`.group-panel[rel="${t.key}"]`).addClass("shown")});o.append(s);let n=$(`<div class="group-panel" rel="${t.key}"></div>`);this.$configPannel.append(n);let i=$('<div class="panel-contents hh-scroll"></div>');n.append(i);let p=this.modules.filter(e=>e.group===t.key);for(let t of p){let o=e.getConfigModuleKey(t.group,t.configSchema.baseKey),s=this.config[o],n=$(`<div class="config-setting ${s?"enabled":""} ${t.configSchema.subSettings?"has-subsettings":""}" rel="${o}"></div>`),p=$(`<label class="base-setting">\n            <span>${t.configSchema.label}</span>\n            <input type="checkbox" name="${o}" ${s?'checked="checked"':""}>\n          </label>`);if(n.append(p),t.configSchema.subSettings){let o=$('<div class="sub-settings"></div>');for(let n of t.configSchema.subSettings){let i=e.getConfigSubSettingKey(t.group,t.configSchema.baseKey,n.key),p=this.config[i];o.append(`<label><input type="checkbox" name="${i}" ${p?'checked="checked"':""} ${s?"":"disabled"}><span>${n.label}</span></label>`)}n.append(o)}i.append(n)}}this.$configPannel.on("change",'.config-setting input[type="checkbox"]',t=>{let o=$(t.target),s=o.attr("name");if(!s)return;let n=o.is(":checked");e.setConfigValue(s,n),o.parent().hasClass("base-setting")&&(o.parent().parent().toggleClass("enabled",n),o.parent().parent().hasClass("has-subsettings"))&&o.parent().siblings(".sub-settings").find('input[type="checkbox"]').prop("disabled",!n)}),this.$configPannel.children(".tabs").children().first().trigger("click")}},n=class{constructor(){this.hasRun=!1,this.group="BoobStrapper",this.configSchema={baseKey:"boobStrapBDSM",label:"Emulate HH++ BDSM",default:!0}}run(){this.hasRun||(this.hasRun=!0,unsafeWindow.hhPlusPlusConfig={registerGroup:unsafeWindow.BoobStrapperConfig.registerGroup,registerModule:unsafeWindow.BoobStrapperConfig.registerModule,loadConfig(){},runModules:unsafeWindow.BoobStrapperConfig.runModules,BoobStrapped:!0},unsafeWindow.HHPlusPlus={Helpers:{doWhenSelectorAvailable:t.doWhenSelectorAvailable},BoobStrapped:!0},$(document).trigger("hh++-bdsm:loaded"))}};new class{constructor(){new s,this.registerBoobStrapModules()}registerBoobStrapModules(){unsafeWindow.BoobStrapperConfig.registerGroup({key:"BoobStrapper",name:"Boob Strapper"}),unsafeWindow.BoobStrapperConfig.registerModule(new n),unsafeWindow.BoobStrapperConfig.runModules()}}})();