// ==UserScript==
// @name         BoobStrapper
// @namespace    http://tampermonkey.net/
// @version      1.1.3
// @description  
// @author       infarcactus
// @license      ISC
// @match        https://nutaku.haremheroes.com/*
// @match        https://*.hentaiheroes.com/*
// @match        https://*.gayharem.com/*
// @match        https://*.comixharem.com/*
// @match        https://*.hornyheroes.com/*
// @match        https://*.pornstarharem.com/*
// @match        https://*.transpornstarharem.com/*
// @match        https://*.gaypornstarharem.com/*
// @match        https://*.mangarpg.com/*
// @updateURL    https://github.com/infarcactus-HH/BoobStrapper/raw/refs/heads/main/dist/userscript.user.js
// @downloadURL  https://github.com/infarcactus-HH/BoobStrapper/raw/refs/heads/main/dist/userscript.user.js
// @grant        unsafeWindow
// @grant        GM_getValue
// @grant        GM_setValue
// @grant        GM_deleteValue
// @grant        GM_addStyle
// @run-at       document-body
// ==/UserScript==

"use strict";(()=>{var e=class{static getConfigValue(e,t){return GM_getValue(e,t)}static setConfigValue(e,t){GM_setValue(e,t)}static getConfigModuleKey(e,t){return`${e}_${t}`}static getConfigSubSettingKey(e,t,s){return`${e}_${t}_${s}`}};function t(e){return"object"==typeof e&&null!==e}function s(e){return t(e)&&"string"==typeof e.key&&"string"==typeof e.label&&"boolean"==typeof e.default}var o=class{static doWhenSelectorAvailable(e,t){let s=$(e);if(s.length)t(s);else{let s=new MutationObserver(()=>{let o=$(e);o.length&&(s.disconnect(),t(o))});s.observe(document.documentElement,{childList:!0,subtree:!0})}}},n=class{static run(){GM_addStyle(`:root {--cross-icon : url(${IMAGES_URL}/clubs/ic_xCross.png)}`)}},i=class{constructor(){this.groups=new Map,this.modules=new Map,this.modulesByGroup=new Map,this.config=new Map,this.$settingsButton=null,this.$configPannel=null,unsafeWindow.BoobStrapperConfig={registerGroup:this.registerGroup.bind(this),registerModule:this.registerModule.bind(this),runModules:this.runModules.bind(this),getModuleSettings:this.getModuleSettings.bind(this),getAllSettings:this.getAllSettings.bind(this)},unsafeWindow.BoobStrapper={Helpers:{doWhenSelectorAvailable:o.doWhenSelectorAvailable}},"/home.html"===location.pathname&&this.addConfigToggles(),$(document).trigger("boobstrapper:loaded")}registerGroup(e){if(!(t(s=e)&&"string"==typeof s.key&&s.key.length>0&&"string"==typeof s.name&&s.name.length>0))throw new Error("Invalid group");var s;this.groups.has(e.key)?console.warn(`Group with key ${e.key} is already registered.`):this.groups.set(e.key,e)}registerModule(e){if(!t(o=e)||"string"!=typeof o.group||!function(e){return t(e)&&"string"==typeof e.baseKey&&"string"==typeof e.label&&"boolean"==typeof e.default&&(void 0===e.subSettings||Array.isArray(e.subSettings)&&e.subSettings.every(s))}(o.configSchema)||"function"!=typeof o.run)throw new Error("Invalid module");var o;let n=this.groups.get(e.group);if(!n)throw new Error(`Group with key ${e.group} is not registered.`);let i=this.getModuleIdentifier(e.group,e.configSchema.baseKey);if(this.modules.has(i))return void console.warn(`Module ${e.group}/${e.configSchema.baseKey} is already registered.`);this.modules.set(i,e);let a=this.modulesByGroup.get(n.key)??[];a.push(e),this.modulesByGroup.set(n.key,a);let p=this.getModuleStorageKey(e.group,e.configSchema.baseKey);if(this.getConfigValue(p,e.configSchema.default),e.configSchema.subSettings)for(let t of e.configSchema.subSettings){let s=this.getSubSettingStorageKey(e.group,e.configSchema.baseKey,t.key);this.getConfigValue(s,t.default)}}runModules(){for(let e of this.modules.values()){let t=this.getModuleSettings(e.group,e.configSchema.baseKey);if(t?.enabled)try{e.run(t.subSettings)}catch(t){console.error(`Error running module ${e.configSchema.baseKey}:`,t)}}}getModuleSettings(e,t){let s=this.getModuleIdentifier(e,t),o=this.modules.get(s);if(!o)return console.warn(`Module ${e}/${t} was requested but is not registered.`),null;let n=this.getModuleStorageKey(e,t),i=this.getConfigValue(n,o.configSchema.default),a={};for(let s of o.configSchema.subSettings??[]){let o=this.getSubSettingStorageKey(e,t,s.key);a[s.key]=this.getConfigValue(o,s.default)}return{enabled:i,subSettings:a}}getAllSettings(){let e={};for(let[t,s]of this.modulesByGroup.entries()){e[t]={};for(let o of s){let s=this.getModuleSettings(o.group,o.configSchema.baseKey);s&&(e[t][o.configSchema.baseKey]={enabled:s.enabled,subSettings:{...s.subSettings}})}}return e}getModuleIdentifier(e,t){return`${e}::${t}`}getModuleStorageKey(t,s){return e.getConfigModuleKey(t,s)}getSubSettingStorageKey(t,s,o){return e.getConfigSubSettingKey(t,s,o)}getConfigValue(t,s){if(this.config.has(t))return this.config.get(t);let o=e.getConfigValue(t,s);return this.config.set(t,o),o}updateConfigValue(t,s){this.config.set(t,s),e.setConfigValue(t,s)}addConfigToggles(){(async function(){n.run(),GM_addStyle('.hh-plus-plus-config-button.boob-strapped{position:absolute;right:200px;cursor:pointer;background-size:contain;background-image:url(https://hh.hh-content.com/pictures/gallery/18/200x/274ee3398698f14a0f26550be9e29c2f.webp);z-index:5}@media(min-width:1026px){.hh-plus-plus-config-button.boob-strapped{height:40px;width:40px;top:56px}}@media(max-width:1025px){.hh-plus-plus-config-button.boob-strapped{height:70px;width:70px;top:85px;right:140px}}@media(min-width:1026px){.hh-plus-plus-config-button.boob-strapped:after{font-size:15px;height:20px;line-height:20px}}@media(max-width:1025px){.hh-plus-plus-config-button.boob-strapped:after{font-size:25px;height:40px;line-height:46px}}.hh-plus-plus-config-button.boob-strapped:after{content:"BS";position:absolute;width:auto;bottom:-3px;right:-5px;text-shadow:0 0 1px #000,0 0 1px #000,0 0 1px #000,0 0 1px #000,0 0 1px #000,0 0 1px #000,0 0 1px #000,0 0 1px #000,0 0 1px #000,0 0 1px #000,0 0 1px #000;-webkit-transform:rotate(-18.95deg);-moz-transform:rotate(-18.95deg);transform:rotate(-18.95deg)}')})(),this.$settingsButton=$('<div class="hh-plus-plus-config-button boob-strapped" hh_title="BoobStrapper" tooltip></div>').on("click",()=>{this.generateConfigPannel()}),o.doWhenSelectorAvailable("#contains_all",e=>{this.$settingsButton&&e.append(this.$settingsButton)})}generateConfigPannel(){if(this.$configPannel&&!this.$configPannel.hasClass("shown"))return void this.$configPannel.addClass("shown");if(!this.$settingsButton||this.$configPannel)return;(async function(){GM_addStyle(".hh-plus-plus-config-panel.boob-strapper{background:linear-gradient(to top,#572332 0 1%,#2c1e1c);border-image-slice:1;border-image-source:linear-gradient(180deg,#ffa23e,#c41b53);border-style:solid;border-width:4px;box-shadow:inset 0 0 40px 15px #662034;display:none;height:470px;position:absolute;right:63px;top:70px;width:900px;z-index:100}.hh-plus-plus-config-panel.boob-strapper.shown{display:block}.hh-plus-plus-config-panel.boob-strapper .close-config-panel{background-image:var(--cross-icon);background-size:cover;cursor:pointer;display:block;height:37px;position:absolute;right:6px;top:6px;width:41px}.hh-plus-plus-config-panel.boob-strapper .tabs{display:flex;height:2.5rem;max-width:53rem;white-space:nowrap}.hh-plus-plus-config-panel.boob-strapper .tabs h4{color:#d08467;cursor:pointer;display:block;float:left;font-size:18px;font-weight:400;height:26px;letter-spacing:.22px;line-height:30px;margin:0 15px;position:relative;text-align:center;text-shadow:1px 1px 0 #000,-1px 1px 0 #000,-1px -1px 0 #000,1px -1px 0 #000}.hh-plus-plus-config-panel.boob-strapper .tabs h4:first-child{margin-left:15px}.hh-plus-plus-config-panel.boob-strapper .tabs h4.selected{color:#ffb827;cursor:initial;font-size:20px;font-weight:400;height:30px;letter-spacing:.22px;padding-top:2px;text-shadow:-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000,-2px -2px 5px rgba(255,159,0,.4),2px -2px 5px rgba(255,159,0,.4),-2px 2px 5px rgba(255,159,0,.4),2px 2px 5px rgba(255,159,0,.4),0 0 10px rgba(255,159,0,.4)}.hh-plus-plus-config-panel.boob-strapper .group-panel{display:none;height:405px;position:absolute;top:54px;width:889px}.hh-plus-plus-config-panel.boob-strapper .group-panel.shown{display:block}.hh-plus-plus-config-panel.boob-strapper .group-panel .panel-contents{display:grid;gap:10px;grid-template-columns:repeat(5,1fr);height:100%;padding-left:10px;padding-right:10px;width:100%}.hh-plus-plus-config-panel.boob-strapper .config-setting{background:#200307e6;border:1px solid #aaa;border-radius:6px;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;font-size:14px;padding:7px}.hh-plus-plus-config-panel.boob-strapper .config-setting.enabled{border-color:#ffb827}.hh-plus-plus-config-panel.boob-strapper .config-setting.has-subsettings{grid-row-end:span 2}.hh-plus-plus-config-panel.boob-strapper .base-setting{display:flex}.hh-plus-plus-config-panel.boob-strapper .base-setting span{flex:1}.hh-plus-plus-config-panel.boob-strapper .sub-settings{font-size:12px;margin-top:8px}.hh-plus-plus-config-panel.boob-strapper .sub-settings label{align-items:center;display:flex;margin-bottom:6px}.hh-plus-plus-config-panel.boob-strapper .sub-settings label span{flex:1}.hh-plus-plus-config-panel.boob-strapper .sub-settings label input{margin-left:0}.hh-plus-plus-config-panel.boob-strapper .sub-settings label input[disabled]{background-color:initial;box-shadow:unset;-webkit-box-shadow:unset}")})(),this.$configPannel=$('<div class="hh-plus-plus-config-panel boob-strapper shown">'),this.$settingsButton.after(this.$configPannel);let e=$('<span class="close-config-panel"></span>').on("click",()=>{this.$configPannel?.removeClass("shown")});this.$configPannel.append(e);let t=$('<div class="tabs boob-strapper hh-scroll"></div>');this.$configPannel.append(t);for(let e of this.groups.values()){let s=e.key,o=$(`<h4 class="${s}" rel="${s}">${e.name}</div>`).on("click",()=>{o.siblings().removeClass("selected"),o.addClass("selected"),this.$configPannel?.find(".group-panel").removeClass("shown").filter(`.group-panel[rel="${s}"]`).addClass("shown")});t.append(o);let n=$(`<div class="group-panel" rel="${s}"></div>`);this.$configPannel.append(n);let i=$('<div class="panel-contents hh-scroll"></div>');n.append(i);let a=this.modulesByGroup.get(s)??[];for(let e of a){let t=this.getModuleStorageKey(e.group,e.configSchema.baseKey),s=this.getModuleSettings(e.group,e.configSchema.baseKey);if(!s)continue;let o=s.enabled,n=$(`<div class="config-setting ${o?"enabled":""} ${e.configSchema.subSettings?"has-subsettings":""}" rel="${t}"></div>`),a=$(`<label class="base-setting">\n            <span>${e.configSchema.label}</span>\n            <input type="checkbox" name="${t}" ${o?'checked="checked"':""}>\n          </label>`);if(n.append(a),e.configSchema.subSettings){let t=$('<div class="sub-settings"></div>');for(let n of e.configSchema.subSettings){let i=this.getSubSettingStorageKey(e.group,e.configSchema.baseKey,n.key),a=s.subSettings[n.key];t.append(`<label><input type="checkbox" name="${i}" ${a?'checked="checked"':""} ${o?"":"disabled"}><span>${n.label}</span></label>`)}n.append(t)}i.append(n)}}this.$configPannel.on("change",'.config-setting input[type="checkbox"]',e=>{let t=$(e.target),s=t.attr("name");if(!s)return;let o=t.is(":checked");this.updateConfigValue(s,o),t.parent().hasClass("base-setting")&&(t.parent().parent().toggleClass("enabled",o),t.parent().parent().hasClass("has-subsettings"))&&t.parent().siblings(".sub-settings").find('input[type="checkbox"]').prop("disabled",!o)}),this.$configPannel.children(".tabs").children().first().trigger("click")}},a=class{constructor(){this.hasRun=!1,this.group="BoobStrapper",this.configSchema={baseKey:"boobStrapBDSM",label:"Emulate HH++ BDSM",default:!1}}run(){this.hasRun||(this.hasRun=!0,unsafeWindow.hhPlusPlusConfig={registerGroup:unsafeWindow.BoobStrapperConfig.registerGroup,registerModule:unsafeWindow.BoobStrapperConfig.registerModule,loadConfig(){},runModules:unsafeWindow.BoobStrapperConfig.runModules,BoobStrapped:!0},unsafeWindow.HHPlusPlus={Helpers:{doWhenSelectorAvailable:o.doWhenSelectorAvailable},BoobStrapped:!0},$(document).trigger("hh++-bdsm:loaded"))}};new class{constructor(){new i,this.registerBoobStrapModules()}registerBoobStrapModules(){unsafeWindow.BoobStrapperConfig.registerGroup({key:"BoobStrapper",name:"Boob Strapper"}),unsafeWindow.BoobStrapperConfig.registerModule(new a),unsafeWindow.BoobStrapperConfig.runModules()}}})();