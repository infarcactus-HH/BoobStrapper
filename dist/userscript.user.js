// ==UserScript==
// @name         BoobStraper
// @namespace    http://tampermonkey.net/
// @version      1.0.0
// @description  
// @author       infarcactus
// @license      ISC
// @match        https://nutaku.haremheroes.com/*
// @match        https://*.hentaiheroes.com/*
// @match        https://*.gayharem.com/*
// @match        https://*.comixharem.com/*
// @match        https://*.hornyheroes.com/*
// @match        https://*.pornstarharem.com/*
// @match        https://*.transpornstarharem.com/*
// @match        https://*.gaypornstarharem.com/*
// @match        https://*.mangarpg.com/*
// @grant        unsafeWindow
// @grant        GM_getValue
// @grant        GM_setValue
// @grant        GM_deleteValue
// @grant        GM_addStyle
// @run-at       document-body
// ==/UserScript==

"use strict";(()=>{var e=class{static getConfigValue(e,t){return GM_getValue(e,t)}static setConfigValue(e,t){GM_setValue(e,t)}static getConfigModuleKey(e,t){return`Config_${e}_${t}`}static getConfigSubSettingKey(e,t,n){return`Config_${e}_${t}_SubSetting_${n}`}},t=class{static doWhenSelectorAvailable(e,t){let n=$(e);if(n.length)t(n);else{let n=new MutationObserver(()=>{let i=$(e);i.length&&(n.disconnect(),t(i))});n.observe(document.documentElement,{childList:!0,subtree:!0})}}},n=class{static run(){t.doWhenSelectorAvailable("header > .hh_logo > img",e=>{let t=e.attr("src");GM_addStyle(`:root {--config-button-icon: url(${t});}`)}),GM_addStyle(`:root {--cross-icon : url(${IMAGES_URL}/clubs/ic_xCross.png)}`)}};new class{constructor(){this.groups=[],this.modules=[],this.config={},this.$settingsButton=null,this.$configPannel=null,unsafeWindow.hhPlusPlusConfig={registerGroup:this.registerGroup.bind(this),registerModule:this.registerModule.bind(this),loadConfig(){},runModules:this.runModules.bind(this),BoobStrapped:!0},unsafeWindow.HHPlusPlus={Helpers:{doWhenSelectorAvailable:t.doWhenSelectorAvailable},BoobStrapped:!0},unsafeWindow.BoobStrapperConfig=unsafeWindow.hhPlusPlusConfig,unsafeWindow.BoobStrapper=unsafeWindow.HHPlusPlus,$(document).trigger("hh++-bdsm:loaded"),this.addConfigToggles()}registerGroup(e){if(!(t=e).key||!t.name)throw new Error("Invalid group");var t;this.groups.find(t=>t.key===e.key)?console.warn(`Group with key ${e.key} is already registered.`):this.groups.push(e)}registerModule(t){if(!((n=t).group&&n.configSchema&&n.configSchema.baseKey&&n.configSchema.label&&void 0!==n.configSchema.default&&void 0!==n.run))throw new Error("Invalid module");var n;if(!this.groups.find(e=>e.key===t.group))throw new Error(`Group with key ${t.configSchema.baseKey} is not registered.`);this.modules.push(t);let i=e.getConfigModuleKey(t.group,t.configSchema.baseKey);if(this.config[i]=e.getConfigValue(i,t.configSchema.default),t.configSchema.subSettings){let n=t.configSchema.baseKey;for(let i of t.configSchema.subSettings){let s=e.getConfigSubSettingKey(t.group,n,i.key);this.config[s]=e.getConfigValue(s,i.default)}}}runModules(){for(let t of this.modules){let n=e.getConfigModuleKey(t.group,t.configSchema.baseKey);if(this.config[n]){let n=t.configSchema.subSettings?.reduce((n,i)=>{let s=e.getConfigSubSettingKey(t.group,t.configSchema.baseKey,i.key);return n[i.key]=this.config[s],n},{});try{t.run(n)}catch(e){console.error(`Error running module ${t.configSchema.baseKey}:`,e)}}}}addConfigToggles(){(async function(){n.run(),GM_addStyle('.hh-plus-plus-config-button{position:absolute;right:50px;cursor:pointer;background-size:contain;background-image:var(--config-button-icon);z-index:5}@media(min-width:1026px){.hh-plus-plus-config-button{height:35px;width:35px;top:56px}}@media(max-width:1025px){.hh-plus-plus-config-button{height:64px;width:64px;top:85px}}@media(min-width:1026px){.hh-plus-plus-config-button:after{font-size:20px;height:20px;line-height:20px}}@media(max-width:1025px){.hh-plus-plus-config-button:after{font-size:35px;height:40px;line-height:46px}}.hh-plus-plus-config-button:after{content:"BS";position:absolute;width:auto;bottom:-3px;right:-5px;text-shadow:0 0 1px #000,0 0 1px #000,0 0 1px #000,0 0 1px #000,0 0 1px #000,0 0 1px #000,0 0 1px #000,0 0 1px #000,0 0 1px #000,0 0 1px #000,0 0 1px #000;-webkit-transform:rotate(-18.95deg);-moz-transform:rotate(-18.95deg);transform:rotate(-18.95deg)}')})(),this.$settingsButton=$('<div class="hh-plus-plus-config-button" hh_title="BoobStrapper" tooltip=""></div>').on("click",()=>{this.generateConfigPannel()}),t.doWhenSelectorAvailable("#contains_all",e=>{this.$settingsButton&&e.append(this.$settingsButton)})}generateConfigPannel(){if(this.$configPannel&&!this.$configPannel.hasClass("shown"))return void this.$configPannel.addClass("shown");if(!this.$settingsButton||this.$configPannel)return;(async function(){GM_addStyle(".hh-plus-plus-config-panel{background:linear-gradient(to top,#572332 0 1%,#2c1e1c);border-image-slice:1;border-image-source:linear-gradient(180deg,#ffa23e,#c41b53);border-style:solid;border-width:4px;box-shadow:inset 0 0 40px 15px #662034;display:none;height:470px;position:absolute;right:63px;top:70px;width:900px;z-index:100}.hh-plus-plus-config-panel.shown{display:block}.close-config-panel{background-image:var(--cross-icon);background-size:cover;cursor:pointer;display:block;height:37px;position:absolute;right:6px;top:6px;width:41px}.hh-plus-plus-config-panel .tabs{display:flex;height:2.5rem;max-width:53rem;white-space:nowrap}.tabs h4{color:#d08467;cursor:pointer;display:block;float:left;font-size:18px;font-weight:400;height:26px;letter-spacing:.22px;line-height:30px;margin:0 15px;position:relative;text-align:center;text-shadow:1px 1px 0 #000,-1px 1px 0 #000,-1px -1px 0 #000,1px -1px 0 #000}.tabs h4:first-child{margin-left:30px}.tabs h4.selected{color:#ffb827;cursor:initial;font-size:20px;font-weight:400;height:30px;letter-spacing:.22px;padding-top:2px;text-shadow:-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000,-2px -2px 5px rgba(255,159,0,.4),2px -2px 5px rgba(255,159,0,.4),-2px 2px 5px rgba(255,159,0,.4),2px 2px 5px rgba(255,159,0,.4),0 0 10px rgba(255,159,0,.4)}.hh-plus-plus-config-panel .group-panel{display:none;height:405px;position:absolute;top:54px;width:889px}.hh-plus-plus-config-panel .group-panel.shown{display:block}.hh-plus-plus-config-panel .group-panel .panel-contents{display:grid;gap:10px;grid-template-columns:repeat(5,1fr);height:100%;padding-left:10px;padding-right:10px;width:100%}.hh-plus-plus-config-panel .config-setting{background:#200307e6;border:1px solid #aaa;border-radius:6px;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;font-size:14px;padding:7px}.hh-plus-plus-config-panel .config-setting.enabled{border-color:#ffb827}.hh-plus-plus-config-panel .config-setting.has-subsettings{grid-row-end:span 2}.hh-plus-plus-config-panel .base-setting{display:flex}.hh-plus-plus-config-panel .base-setting span{flex:1}.hh-plus-plus-config-panel .sub-settings{font-size:12px;margin-top:8px}.hh-plus-plus-config-panel .sub-settings label{align-items:center;display:flex;margin-bottom:6px}.hh-plus-plus-config-panel .sub-settings label span{flex:1}.hh-plus-plus-config-panel .sub-settings label input{margin-left:0}.hh-plus-plus-config-panel .sub-settings label input[disabled]{background-color:initial;box-shadow:unset;-webkit-box-shadow:unset}")})(),this.$configPannel=$('<div class="hh-plus-plus-config-panel shown">'),this.$settingsButton.after(this.$configPannel);let t=$('<span class="close-config-panel"></span>').on("click",()=>{this.$configPannel?.removeClass("shown")});this.$configPannel.append(t);let n=$('<div class="tabs hh-scroll"></div>');this.$configPannel.append(n);for(let t of this.groups){let i=$(`<h4 class="${t.key}" rel="${t.key}">${t.name}</div>`).on("click",()=>{i.siblings().removeClass("selected"),i.addClass("selected"),this.$configPannel?.find(".group-panel").removeClass("shown").filter(`.group-panel[rel="${t.key}"]`).addClass("shown")});n.append(i);let s=$(`<div class="group-panel" rel="${t.key}"></div>`);this.$configPannel.append(s);let o=$('<div class="panel-contents hh-scroll"></div>');s.append(o);let l=this.modules.filter(e=>e.group===t.key);for(let t of l){let n=e.getConfigModuleKey(t.group,t.configSchema.baseKey),i=this.config[n],s=$(`<div class="config-setting ${i?"enabled":""} ${t.configSchema.subSettings?"has-subsettings":""}" rel="${n}"></div>`),l=$(`<label class="base-setting">\n            <span>${t.configSchema.label}</span>\n            <input type="checkbox" name="${n}" ${i?'checked="checked"':""}>\n          </label>`);if(s.append(l),t.configSchema.subSettings){let n=$('<div class="sub-settings"></div>');for(let s of t.configSchema.subSettings){let o=e.getConfigSubSettingKey(t.group,t.configSchema.baseKey,s.key),l=this.config[o];n.append(`<label><input type="checkbox" name="${o}" ${l?'checked="checked"':""} ${i?"":"disabled"}><span>${s.label}</span></label>`)}s.append(n)}o.append(s)}}this.$configPannel.on("change",'.config-setting input[type="checkbox"]',t=>{let n=$(t.target),i=n.attr("name");if(!i)return;let s=n.is(":checked");e.setConfigValue(i,s),n.parent().hasClass("base-setting")&&(n.parent().parent().toggleClass("enabled",s),n.parent().parent().hasClass("has-subsettings"))&&n.parent().siblings(".sub-settings").find('input[type="checkbox"]').prop("disabled",!s)}),this.$configPannel.children(".tabs").children().first().trigger("click")}}})();